<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Video Recorder</title>
</head>

<body>
    <h1>Record Your Video</h1>
    <video id="preview" width="640" height="480" autoplay></video>
    <br>
    <button id="startBtn">Start Recording</button>
    <button id="stopBtn" disabled>Stop Recording</button>

    <script>
        const preview = document.getElementById('preview');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');

        let mediaRecorder;
        let recordedChunks = [];

        // Get access to the webcam
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then(stream => {
                preview.srcObject = stream;

                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    recordedChunks = [];

                    // Upload video to server
                    const formData = new FormData();
                    formData.append('video', blob, 'recorded_video.webm');

                    fetch('/upload', {
                        method: 'POST',
                        body: formData
                    }).then(response => {
                        alert('Video uploaded successfully!');
                    }).catch(err => {
                        console.error(err);
                    });
                };
            })
            .catch(err => {
                console.error('Error accessing webcam: ', err);
            });

        startBtn.onclick = () => {
            mediaRecorder.start();
            startBtn.disabled = true;
            stopBtn.disabled = false;
        };

        stopBtn.onclick = () => {
            mediaRecorder.stop();
            startBtn.disabled = false;
            stopBtn.disabled = true;
        };
    </script>
</body>

</html>