{% extends "base.html" %}

{% block body_class %}recorder-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/index.css" />
<link rel="stylesheet" href="/static/css/recorder.css" />
{% endblock %}

{% block content %}
  <h1 class="brand">Record Your Video</h1>
  <div class="recorder-frame">
    <video id="preview" width="640" height="480" autoplay></video>
  </div>
  <div class="recorder-actions">
    <button class="cta recorder-btn" id="recordBtn">Start Recording</button>
  </div>
{% endblock %}

{% block scripts %}
<script>
  const preview = document.getElementById("preview");
  const recordBtn = document.getElementById("recordBtn");

  let mediaRecorder;
  let recordedChunks = [];
  let isRecording = false;

    // Get access to the webcam
    navigator.mediaDevices
      .getUserMedia({ video: true, audio: true })
      .then((stream) => {
        preview.srcObject = stream;

        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          recordedChunks = [];

          let fileName = prompt("Enter a name for your masterpiece:", "my_video");
          if (!fileName) {
            fileName = "untitled_video";
          }

          // Make sure filename ends with .webm
          if (!fileName.endsWith(".webm")) {
            fileName += ".webm";
          }

  recordBtn.onclick = () => {
    if (!isRecording) {
      mediaRecorder.start();
      isRecording = true;
      recordBtn.textContent = "Stop Recording";
      recordBtn.classList.add("recording");
    } else {
      mediaRecorder.stop();
      isRecording = false;
      recordBtn.textContent = "Start Recording";
      recordBtn.classList.remove("recording");
    }
  };
// ...existing code...
</script>
{% endblock %}



{% comment %} efsfg {% endcomment %}